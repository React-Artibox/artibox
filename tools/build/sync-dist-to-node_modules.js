const fs = require('fs');
const path = require('path');
const { exec } = require('child_process');

const { PWD, npm_package_name } = process.env;

const NODE_MODULES_PATH = path.resolve(__dirname, '..', '..', 'node_modules');

let packagePathPointer = NODE_MODULES_PATH;

npm_package_name.split('/').forEach(dir => {
  const current = path.resolve(packagePathPointer, dir);
  packagePathPointer = current;

  if (!fs.existsSync(current)) {
    exec(`mkdir ${current}`);
  }
});

exec(`rsync -ar --exclude-from=${PWD}/.npmignore ${PWD}/dist/ ${packagePathPointer}`);
